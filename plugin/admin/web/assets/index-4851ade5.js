import{f as e,d as g,U as L,V as A,u as t,$ as d,E as s,F as M,g as V,e as B}from"./vue-14860272.js";import{u as H}from"./formily-bb5e2124.js";import{J as W,a9 as v,ag as R,af as G,ah as U,R as $,ai as K,aj as E}from"./index-9471e750.js";import{u as b}from"./index-79686afe.js";import"./dayjs-4778c158.js";import{_ as P}from"./scroll-tip.vue_vue_type_script_setup_true_lang-eaf6d5ea.js";import{u as j}from"./useModal-7947e4f5.js";import{s as z}from"./gb28281-7f973980.js";import{u as q}from"./usePlay-6d00e15a.js";import{D as J}from"./index-8832d649.js";import{u as X}from"./device-90cc1555.js";import{C as T}from"./Card-16e79183.js";import{S as Y}from"./index-b3d84ac5.js";import"./index-8482cc93.js";import"./LeftOutlined-cacc5a61.js";import"./isNumeric-3f69e2aa.js";import"./index-afcca74b.js";import"./index-7f09d6d5.js";import"./index-e5b3ef59.js";import"./index-60dfa61c.js";import"./Group-00a85e2d.js";import"./useFlexGapSupport-ef7c1a5e.js";import"./index-e7a5e773.js";import"./index-0e20189e.js";import"./index-eebab99f.js";import"./scrollTo-ad66e0fa.js";import"./mockjs-890b569b.js";import"./index-9d94a5eb.js";import"./index-b8e4a2f4.js";import"./jb4-8ec36186.js";import"./index-744a466c.js";const Q=l=>({type:"object",properties:{layout:{type:"void","x-component":"FormLayout","x-component-props":{layout:"inline"},properties:{Name:{type:"string","x-decorator":"FormItem","x-decorator-props":{style:"margin-right: 10px;width: 260px"},"x-component":"Input","x-component-props":{placeholder:"请输入设备编号或名称搜索","@keyup":l},"x-content":{prefix:()=>e(W,{icon:"ic:outline-search"},null)}}}}}}),Z=g({name:"Channel"}),ee=g({...Z,props:{detail:null,device:null},setup(l){const p=l,m={0:"空闲",1:"拉流中",2:"已拉流"},c=b(),f={maxHeight:"530px",rowConfig:{keyField:"DeviceID",useKey:!0},columnConfig:{useKey:!0},columns:[{field:"DeviceID",title:"编号",showOverflow:"tooltip",width:"200px",fixed:"left"},{field:"Name",title:"名称",showOverflow:"tooltip",width:"120px",fixed:"left"},{field:"Status",title:"状态",minWidth:"100px"},{field:"LiveStatus",title:"拉流状态",minWidth:"120px",formatter:({cellValue:o})=>m[o]},{field:"Manufacturer",title:"厂商",width:"120px"},{field:"Address",title:"地址",showOverflow:"tooltip",width:"180px"},{field:"Port",title:"端口",width:"70px"},{field:"Model",title:"型号",width:"180px"},{field:"Owner",title:"Owner",width:"120px"},{field:"CivilCode",title:"CivilCode",width:"120px"},{field:"Parental",title:"Parental",width:"120px"},{field:"SafetyWay",title:"SafetyWay",width:"120px"},{field:"RegisterWay",title:"RegisterWay",width:"120px"},{field:"Secrecy",title:"Secrecy",width:"120px"},{field:"operate",title:"操作",width:"140px",slots:{default:"operate"},align:"center",fixed:"right"}],data:p.detail},u=async o=>{const{DeviceID:x,Name:n}=o;await z({id:p.device.ID,channel:x}).then(I=>{const y=p.detail.map(r=>(r.DeviceID===x&&(r.LiveStatus=0),r));c.tableRef.reloadData(y),G.success(`通道 ${n||x} 已停止拉流`)})};return(o,x)=>(L(),A(M,null,[e(t(P)),e(t(R),{uid:t(c).uid,gridOptions:t(f)},{operate:d(({row:n})=>[e(t(v),{size:"small",type:"link",onClick:()=>t(q)({id:l.device.ID,deviceName:l.device.Name,deviceID:n.DeviceID,channelName:n.Name})},{default:d(()=>[s(" 播放 ")]),_:2},1032,["onClick"]),e(t(J),{type:"vertical",class:"m-0"}),e(t(v),{size:"small",type:"link",danger:"",disabled:n.LiveStatus===0,onClick:()=>u(n)},{default:d(()=>[s(" 停止拉流 ")]),_:2},1032,["disabled","onClick"])]),_:1},8,["uid","gridOptions"])],64))}}),te=({row:l,appContext:p,pause:m,resume:c})=>{m();const{Name:f,Channels:u,ID:o}=l;j({content:e(ee,{detail:u||[],device:{ID:o,Name:f}},null),modalConfig:{appContext:p,width:"78%",title:`${f} 通道详情`,okButtonProps:{style:{display:"none"}},cancelText:"关闭",maskClosable:!1,onCancel:()=>c()}})},ie=g({name:"Device"}),Fe=g({...ie,setup(l){var S;const p=(S=V())==null?void 0:S.appContext;U.renderer.add("moreFields",{renderExpand(i,h){const{row:a}=h;return e("p",{class:"flex flex-col p-10px m-0"},[e("span",null,[e("b",null,[s("型号(Model):  ")]),a.Model]),e("span",null,[e("b",null,[s("纬度(Latitude):  ")]),a.Latitude]),e("span",null,[e("b",null,[s("经度(Longitude):  ")]),a.Longitude]),e("span",null,[e("b",null,[s("GpsTime:  ")]),a.GpsTime]),e("span",null,[e("b",null,[s("Owner:  ")]),a.Owner])])}});const m=X(),c=B(()=>m.deviceList),{httpRefreshTime:f}=$({VITE_PORT:"3000",VITE_GLOB_APP_TITLE:"M7S_ADMIN",VITE_GLOB_APP_SHORT_NAME:"m7s_admin",VITE_USE_MOCK:"true",VITE_PUBLIC_PATH:"/admin",VITE_DROP_CONSOLE:"true",VITE_BUILD_COMPRESS:"none",VITE_BUILD_COMPRESS_DELETE_ORIGIN_FILE:"false",VITE_GLOB_HTTP_REFRESH_TIME:"5000",VITE_USE_IMAGEMIN:"true",VITE_LEGACY:"false",VITE_M7S_SERVER:"",BASE_URL:"/admin",MODE:"production",DEV:!1,PROD:!0,SSR:!1}),{pause:u,resume:o}=K(D,f),x=i=>{const h=String(i.target.value).trim().toLowerCase();if(h){const a=new RegExp(h,"gi"),C=["ID","Name"],N=c.value.filter(w=>C.some(_=>String(w[_]).toLowerCase().indexOf(h)>-1)).map(w=>{const _=Object.assign({},w);return C.forEach(O=>{_[O]=String(_[O]).replace(a,k=>`<span style="color: #ff99a0">${k}</span>`)}),_});r(N),u()}else r(c.value),o()},{FormilyForm:n}=H({schema:Q(x)}),I={toggleRowExpand:({expanded:i})=>{i?u():o()}},y=b(),r=i=>{y.tableRef.reloadData(i)};async function D(){await m.fetchDeviceList(),r(m.deviceList)}D();const F={maxHeight:"100%",rowConfig:{keyField:"ID",useKey:!0},columnConfig:{useKey:!0},columns:[{title:"...",width:"30px",type:"expand",contentRender:{name:"moreFields"},fixed:"left"},{field:"ID",title:"设备编号",showOverflow:"tooltip",width:"200px",fixed:"left",type:"html"},{field:"Name",title:"设备名称",showOverflow:"tooltip",width:"120px",type:"html"},{field:"NetAddr",title:"网络地址",showOverflow:"tooltip",width:"180px"},{field:"Channels",title:"通道数",width:"70px",formatter:({cellValue:i})=>(i==null?void 0:i.length)||0},{field:"Status",title:"状态",minWidth:"120px"},{field:"Manufacturer",title:"厂商",width:"120px"},{field:"LastKeepaliveAt",title:"最后保活时间",minWidth:"180px",formatter:({cellValue:i})=>E.toDateString(new Date(i),"yyyy-MM-dd HH:ss:mm")},{field:"RegisterTime",title:"注册时间",minWidth:"180px",formatter:({cellValue:i})=>E.toDateString(new Date(i),"yyyy-MM-dd HH:ss:mm")},{field:"UpdateTime",title:"更新时间",minWidth:"180px",formatter:({cellValue:i})=>E.toDateString(new Date(i),"yyyy-MM-dd HH:ss:mm")},{field:"operate",title:"操作",width:"120px",fixed:"right",align:"center",slots:{default:"operate"}}],data:[]};return(i,h)=>(L(),A(M,null,[e(t(T),{bordered:!1,bodyStyle:{padding:"26px 10px 0 10px",marginBottom:"8px"}},{default:d(()=>[e(t(n))]),_:1}),e(t(T),{bordered:!1,bodyStyle:{padding:"10px",height:"calc(100% - 50px)"},style:{height:"calc(100% - 100px)"}},{default:d(()=>[e(t(P),{windowWidth:1716}),e(t(R),{uid:t(y).uid,gridOptions:t(F),gridEvent:t(I)},{operate:d(({row:a})=>[e(t(Y),null,{default:d(()=>[e(t(v),{size:"small",type:"link",onClick:()=>t(te)({row:a,appContext:t(p),pause:t(u),resume:t(o)})},{default:d(()=>[s(" 通道详情 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["uid","gridOptions","gridEvent"])]),_:1},8,["bodyStyle"])],64))}});export{Fe as default};
